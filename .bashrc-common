#load color codes
source ~/.ansi-colors 

#aliases
alias cd..='cd ..'
alias cd='cd 1> /dev/null'	#suppress output of current directory
if [[ $(uname) == "Darwin" ]]; then
	alias ls='ls -G'
	alias cp='cp -v'
else
	alias ls='ls --color=auto'
	alias cp='cp -v --reflink=auto' #don't duplicate when copying on CoW filesystems like BtrFS
	alias open='xdg-open'
fi
alias la='ls -a'
alias ll='ls -l'
alias lsd='ls -d'
alias lal="ls -al"
alias grep='grep --color=auto'
alias more='less'
alias compress='xz -zvv9ek --check=sha256'
alias mv='mv -v'
alias rm='rm -v'
alias rmdir='rmdir -v'
alias paste="curl -F 'sprunge=<-' http://sprunge.us"

function gitbranch {
    if [[ ! -z ${GITBRANCH+x} ]]; then 
        git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/(\1)/'
    fi
}

#run a program detached from the current terminal
function detach() {
	nohup "$@" > /dev/null &
}

#show fortune cookie if the variable $FORTUNE is set
if [[ ! -z ${FORTUNE+x} ]]; then 
	cowsay -f tux $(fortune); 
fi

#show available disk space
if [[ ! -z ${FREESPACE+x} ]]; then
    if [[ $(uname) == "Darwin" ]]; then
    	df -hlt | head -n 1
		df -hlt | grep --color=never -E "/dev/sd|/dev/mapper|/dev/root|/dev/mmcblk|/dev/vd|/dev/disk|/dev/rdisk"
    else
		df -hlT | head -n 1      #display first line of df ( table header )
		df -hlT | grep --color=never -E "/dev/sd|/dev/mapper|/dev/root|/dev/mmcblk|/dev/vd|/dev/disk|/dev/rdisk"
    fi
fi

#detect root
if [ $EUID -eq 0 ]; then
	PROMPT_LETTER='#'
	PROMPT_COLOR="$cbred"
else
	PROMPT_LETTER='$'
	PROMPT_COLOR="$cbgreen"
fi

#logged in via ssh? If yes, change color to yellow
if [[ ! -z ${SSH_CLIENT+x} ]]; then
    PROMPT_COLOR="$cbyellow"
fi

PS1="$cyellow\$? $PROMPT_COLOR\\u@\\h $cbblue\\w $PROMPT_COLOR$cyellow\$(gitbranch)\n$PROMPT_LETTER$creset "

#colors in manpages
man() {
			#TODO: use color codes from .ansi-colors
	        env \
	                LESS_TERMCAP_mb=$(printf "\e[1;31m") \
	                LESS_TERMCAP_md=$(printf "\e[1;31m") \
	                LESS_TERMCAP_me=$(printf "\e[0m") \
	                LESS_TERMCAP_se=$(printf "\e[0m") \
	                LESS_TERMCAP_so=$(printf "\e[1;44;33m") \
	                LESS_TERMCAP_ue=$(printf "\e[0m") \
	                LESS_TERMCAP_us=$(printf "\e[1;32m") \
                    LANG='' \
	                        man "$@"
}

#environment variables
VISUAL=vim
EDITOR=vim
PAGER=less
CDPATH=".:~"
